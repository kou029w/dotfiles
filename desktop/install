#!/bin/bash
set -euo pipefail
cd -- "$(dirname -- "$0")"
. ../mod.bash
export HOME=$(get_target_home)

function install_gsettings() {
	local -r gsettings_file=$1
	local -r gsettings_dir=$2
	sudo --user="#${SUDO_UID:-$UID}" \
		DBUS_SESSION_BUS_ADDRESS="unix:path=/run/user/${SUDO_UID:-$UID}/bus" \
		dconf load "${gsettings_dir}" <"$gsettings_file"
}

(($(id -u) == 0)) && install_apt_packages
install_gsettings settings.ini /
install_gsettings terminal-settings.ini "/org/gnome/terminal/legacy/profiles:/:$(gsettings get org.gnome.Terminal.ProfilesList default | tr -d \')/"
install_config
fc-cache
