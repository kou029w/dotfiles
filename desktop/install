#!/bin/bash
set -euo pipefail
cd -- "$(dirname -- "$0")"
. ../mod.bash

function install_gsettings() {
  local uid
  local gsettings_file
  local gsettings_dir
  uid=${SUDO_UID:-$(id -u)}
  gsettings_file=$1
  gsettings_dir=$2
  < "$gsettings_file" \
    sudo --user="#$uid" \
    DBUS_SESSION_BUS_ADDRESS="unix:path=/run/user/$uid/bus" \
    dconf load "$gsettings_dir"
}

(($(id -u) == 0)) \
  && [[ -f /etc/debian_version ]] \
  && install_apt_packages
install_gsettings settings.ini /
install_gsettings terminal-settings.ini "/org/gnome/terminal/legacy/profiles:/:$(gsettings get org.gnome.Terminal.ProfilesList default | tr -d \')/"
